<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>B·∫£n ƒë·ªì Ch√¢n M√¢y - LƒÉng C√¥</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Turf.js ƒë·ªÉ t√≠nh di·ªán t√≠ch polygon -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <link rel="stylesheet" href="stylemap.css" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
  <div id="map"></div>
  
  <!-- Loading indicator -->
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
    <span>ƒêang t·∫£i b·∫£n ƒë·ªì...</span>
  </div>
  
  <!-- N√∫t m·ªü sidebar (lu√¥n hi·ªÉn th·ªã) -->
  <button class="sidebar-open" id="sidebar-open" title="M·ªü sidebar">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <!-- ƒê√É X√ìA N√öT TOGGLE B√äN TRONG SIDEBAR -->
    
    <button class="theme-toggle" id="theme-toggle" title="Ch·∫ø ƒë·ªô t·ªëi/s√°ng">
      <i class="fas fa-moon"></i>
    </button>
    
    <div class="sidebar-content">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <h1>üåä Ch√¢n M√¢y - LƒÉng C√¥</h1>
          <p>Kh√°m ph√° c√°c ƒëi·ªÉm du l·ªãch tuy·ªát v·ªùi</p>
        </div>
        <button class="sidebar-close" id="sidebar-close" title="ƒê√≥ng sidebar">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Search Box v·ªõi g·ª£i √Ω th√¥ng minh -->
      <div class="search-container">
        <div class="search-box">
          <input type="text" id="search-input" placeholder="T√¨m ki·∫øm ƒë·ªãa ƒëi·ªÉm, ƒë·ªãa ch·ªâ...">
          <i class="fas fa-search"></i>
        </div>
        <div class="search-suggestions" id="search-suggestions">
          <!-- G·ª£i √Ω t√¨m ki·∫øm s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
        </div>
      </div>
      
      <!-- B·ªô l·ªçc lo·∫°i h√¨nh -->
      <div class="filter-section">
        <div class="filter-header" id="type-filter-header">
          <div class="filter-title">
            <i class="fas fa-filter"></i>
            <span>Lo·∫°i h√¨nh</span>
          </div>
          <button class="filter-toggle" id="type-filter-toggle">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="filter-content" id="type-filter-content">
          <div class="filter-tags">
            <div class="filter-tag" data-type="baibien">
              <i class="fas fa-umbrella-beach"></i>
              <span>B√£i bi·ªÉn</span>
            </div>
            <div class="filter-tag" data-type="nghiduong">
              <i class="fas fa-hotel"></i>
              <span>Resort & Kh√°ch s·∫°n</span>
            </div>
            <div class="filter-tag" data-type="nhahang">
              <i class="fas fa-utensils"></i>
              <span>Nh√† h√†ng & ·∫®m th·ª±c</span>
            </div>
            <div class="filter-tag" data-type="ditich">
              <i class="fas fa-landmark"></i>
              <span>Di t√≠ch l·ªãch s·ª≠</span>
            </div>
            <div class="filter-tag" data-type="giaitri">
              <i class="fas fa-gamepad"></i>
              <span>Gi·∫£i tr√≠</span>
            </div>
            <div class="filter-tag" data-type="muasam">
              <i class="fas fa-shopping-bag"></i>
              <span>Mua s·∫Øm</span>
            </div>
            <div class="filter-tag" data-type="chua">
              <i class="fas fa-place-of-worship"></i>
              <span>Ch√πa chi·ªÅn</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- B·ªô l·ªçc ti√™u ch√≠ -->
      <div class="filter-section">
        <div class="filter-header" id="criteria-filter-header">
          <div class="filter-title">
            <i class="fas fa-star"></i>
            <span>Ti√™u ch√≠</span>
          </div>
          <button class="filter-toggle" id="criteria-filter-toggle">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="filter-content" id="criteria-filter-content">
          <!-- Ph√π h·ª£p gia ƒë√¨nh -->
          <div style="margin-bottom: 15px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: #2d3748;" class="filter-subtitle">Ph√π h·ª£p</div>
            <div class="filter-tags">
              <div class="filter-tag" data-criteria="family">
                <i class="fas fa-users"></i>
                <span>Gia ƒë√¨nh</span>
              </div>
              <div class="filter-tag" data-criteria="couple">
                <i class="fas fa-heart"></i>
                <span>L√£ng m·∫°n</span>
              </div>
              <div class="filter-tag" data-criteria="solo">
                <i class="fas fa-user"></i>
                <span>ƒêi m·ªôt m√¨nh</span>
              </div>
            </div>
          </div>
          
          <!-- Ng√¢n s√°ch -->
          <div style="margin-bottom: 15px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: #2d3748;" class="filter-subtitle">Ng√¢n s√°ch</div>
            <input type="range" min="0" max="4" value="4" class="budget-slider" id="budget-slider">
            <div class="budget-labels">
              <span>Mi·ªÖn ph√≠</span>
              <span>Ti·∫øt ki·ªám</span>
              <span>Trung b√¨nh</span>
              <span>Cao c·∫•p</span>
              <span>Luxury</span>
            </div>
          </div>
          
          <!-- ƒê·ªô tu·ªïi -->
          <div style="margin-bottom: 15px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: #2d3748;" class="filter-subtitle">ƒê·ªô tu·ªïi</div>
            <div class="age-buttons">
              <button class="age-btn active" data-age="all">T·∫•t c·∫£</button>
              <button class="age-btn" data-age="child">Tr·∫ª em</button>
              <button class="age-btn" data-age="teen">Thanh thi·∫øu ni√™n</button>
              <button class="age-btn" data-age="adult">Ng∆∞·ªùi l·ªõn</button>
              <button class="age-btn" data-age="senior">Ng∆∞·ªùi cao tu·ªïi</button>
            </div>
          </div>
          
          <!-- Th·ªùi gian tham quan -->
          <div>
            <div style="font-weight: 600; margin-bottom: 8px; color: #2d3748;" class="filter-subtitle">Th·ªùi gian tham quan</div>
            <input type="range" min="0" max="4" value="4" class="time-slider" id="time-slider">
            <div class="time-labels">
              <span>D∆∞·ªõi 1h</span>
              <span>1-2h</span>
              <span>2-4h</span>
              <span>N·ª≠a ng√†y</span>
              <span>C·∫£ ng√†y</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- N√∫t x√≥a b·ªô l·ªçc -->
      <button class="clear-filters" id="clear-filters">
        <i class="fas fa-times"></i>
        X√≥a t·∫•t c·∫£ b·ªô l·ªçc
      </button>
      
      <h3 style="margin: 20px 0 15px; color: #2d3748;" class="section-title">ƒê·ªãa ƒëi·ªÉm n·ªïi b·∫≠t</h3>
      <ul class="location-list" id="location-list">
        <!-- Danh s√°ch ƒë·ªãa ƒëi·ªÉm s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
      </ul>
    </div>
  </div>
  
  <!-- Info Panel -->
  <div class="info-panel" id="info-panel">
    <div class="info-header">
      <img id="info-image" src="" alt="" class="info-image">
      <button class="info-close" id="info-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="info-content">
      <h2 class="info-title" id="info-title"></h2>
      <p class="info-description" id="info-description"></p>
      
      <!-- Tags trong info panel -->
      <div class="info-tags" id="info-tags">
        <!-- Tags s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
      </div>
      
      <div class="info-details">
        <div class="info-detail">
          <i class="fas fa-map-marker-alt"></i>
          <strong>ƒê·ªãa ch·ªâ:</strong> <span id="info-address"></span>
        </div>
        <div class="info-detail">
          <i class="fas fa-phone"></i>
          <strong>ƒêi·ªán tho·∫°i:</strong> <span id="info-phone"></span>
        </div>
        <div class="info-detail">
          <i class="fas fa-clock"></i>
          <strong>Gi·ªù m·ªü c·ª≠a:</strong> <span id="info-hours"></span>
        </div>
        <div class="info-detail">
          <i class="fas fa-tag"></i>
          <strong>Gi√° v√©:</strong> <span id="info-price"></span>
        </div>
      </div>
      
      <!-- Tips & L∆∞u √Ω Section -->
      <div class="tips-section">
        <div class="tips-header" id="tips-header">
          <div class="tips-title">
            <i class="fas fa-lightbulb"></i>
            <span>Tips & L∆∞u √Ω</span>
          </div>
          <button class="tips-toggle" id="tips-toggle">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="tips-content" id="tips-content">
          <ul class="tips-list" id="tips-list">
            <!-- Tips s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
          </ul>
        </div>
      </div>
      
      <div class="info-actions">
        <button class="info-btn secondary" id="info-direction">
          <i class="fas fa-route"></i> Ch·ªâ ƒë∆∞·ªùng
        </button>
        <button class="info-btn primary" id="info-website">
          <i class="fas fa-external-link-alt"></i> Website
        </button>
      </div>
    </div>
  </div>
  
  <!-- Map Controls - ƒê√É DI CHUY·ªÇN L√äN TR√äN -->
  <div class="map-controls">
    <button class="map-control" id="locate-me" title="V·ªã tr√≠ c·ªßa t√¥i">
      <i class="fas fa-location-arrow"></i>
    </button>
    <button class="map-control" id="toggle-boundary" title="Ranh gi·ªõi">
      <i class="fas fa-draw-polygon"></i>
    </button>
    <button class="map-control" id="toggle-satellite" title="Ch·∫ø ƒë·ªô v·ªá tinh">
      <i class="fas fa-satellite"></i>
    </button>
    <button class="map-control" id="fullscreen" title="To√†n m√†n h√¨nh">
      <i class="fas fa-expand"></i>
    </button>
  </div>
  
  <!-- Legend -->
  <div class="legend" id="legend">
    <h4>
      <span>Ch√∫ th√≠ch</span>
      <button class="legend-toggle" id="legend-toggle" title="·∫®n/hi·ªán ch√∫ th√≠ch">
        <i class="fas fa-eye-slash"></i>
      </button>
    </h4>
    <div class="legend-item">
      <div class="legend-color boundary-color"></div>
      <span>Ranh gi·ªõi khu v·ª±c</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #e74c3c; border-color: #c0392b;"></div>
      <span>Di t√≠ch l·ªãch s·ª≠</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #3498db; border-color: #2980b9;"></div>
      <span>B√£i bi·ªÉn & ƒê·∫ßm n∆∞·ªõc</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #27ae60; border-color: #219a52;"></div>
      <span>Su·ªëi & Th√°c n∆∞·ªõc</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #f39c12; border-color: #e67e22;"></div>
      <span>Khu ngh·ªâ d∆∞·ª°ng</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #9b59b6; border-color: #8e44ad;"></div>
      <span>Ch√πa chi·ªÅn</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #e67e22; border-color: #d35400;"></div>
      <span>Khu mua s·∫Øm</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #1abc9c; border-color: #16a085;"></div>
      <span>Nh√† h√†ng & ·∫®m th·ª±c</span>
    </div>
  </div>

  <!-- N√∫t hi·ªán ch√∫ th√≠ch khi ƒë√£ ·∫©n -->
  <button class="legend-show" id="legend-show" title="Hi·ªán ch√∫ th√≠ch">
    <i class="fas fa-map"></i>
  </button>

  <script>
    // ========== C·∫§U TR√öC D·ªÆ LI·ªÜU V√Ä C·∫§U H√åNH ==========
    
    // C·∫•u h√¨nh ·ª©ng d·ª•ng
    const APP_CONFIG = {
      mapCenter: [16.27, 108.06],
      defaultZoom: 12,
      osmRelationId: 19325212,
      boundaryColor: "#3498db",
      boundaryOpacity: 0.15,
      boundaryWeight: 3
    };

    // D·ªØ li·ªáu c√°c ƒëi·ªÉm ƒë√°nh d·∫•u v·ªõi th√¥ng tin l·ªçc n√¢ng cao
    const MARKERS_DATA = [
      {
        id: 1,
        coords: [16.188057091935168, 108.13126200900261],
        title: "H·∫£i V√¢n Quan",
        description: "H·∫£i V√¢n Quan l√† di t√≠ch l·ªãch s·ª≠ qu√¢n s·ª± th·ªùi Nguy·ªÖn, x√¢y d·ª±ng nƒÉm 1826 tr√™n ƒë·ªânh ƒë√®o H·∫£i V√¢n, ranh gi·ªõi gi·ªØa Hu·∫ø v√† ƒê√† N·∫µng, n·ªïi ti·∫øng v·ªõi ki·∫øn tr√∫c ƒë·ªôc ƒë√°o v√† c·∫£nh quan h√πng vƒ©.",
        image: "https://live.staticflickr.com/573/31685434851_63ec23ccf6_b.jpg",
        category: "ditich",
        color: "#e74c3c",
        link: "https://www.google.com/maps/place/H%E1%BA%A3i+V%C3%A2n+Quan/@16.1877377,108.1287193,836m/data=!3m2!1e3!4b1!4m6!3m5!1s0x3142219e02bc568b:0xb04a3eba486386b5!8m2!3d16.1877377!4d108.1312942!16s%2Fg%2F11p5lgqrq9?hl=vi&entry=ttu&g_ep=EgoyMDI1MTAwOC4wIKXMDSoASAFQAw%3D%3D",
        address: " ƒê√®o H·∫£i V√¢n, gi√°p ranh Th√†nh ph·ªë Hu·∫ø v√† ƒê√† N·∫µng",
        phone: "",
        hours: " 07:00‚Äì17:30",
        price: " Mi·ªÖn ph√≠",
        // Th√¥ng tin l·ªçc n√¢ng cao
        filters: {
          type: "ditich",
          suitability: ["family", "couple", "solo"],
          budget: 0, // 0: Mi·ªÖn ph√≠, 1: Ti·∫øt ki·ªám, 2: Trung b√¨nh, 3: Cao c·∫•p, 4: Luxury
          age: ["child", "teen", "adult", "senior"],
          time: 1 // 0: D∆∞·ªõi 1h, 1: 1-2h, 2: 2-4h, 3: N·ª≠a ng√†y, 4: C·∫£ ng√†y
        },
        // Th√™m tips v√† l∆∞u √Ω
        tips: [
          {
            type: "tip",
            title: "Th·ªùi ƒëi·ªÉm t·ªët nh·∫•t",
            text: "N√™n ƒë·∫øn v√†o s√°ng s·ªõm ho·∫∑c chi·ªÅu mu·ªôn ƒë·ªÉ tr√°nh s∆∞∆°ng m√π v√† c√≥ t·∫ßm nh√¨n ƒë·∫πp nh·∫•t."
          },
          {
            type: "warning",
            title: "L∆∞u √Ω an to√†n",
            text: "Di chuy·ªÉn qua ƒë√®o H·∫£i V√¢n: Kh√¥ng chen l·∫•n, ƒëi h√†ng 2-3 ng∆∞·ªùi, gi·ªØ t·ªëc ƒë·ªô ch·∫≠m ·ªü c√°c kh√∫c cua ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n."
          },
          {
            type: "info",
            title: "Ch·ª•p ·∫£nh",
            text: "ƒê√¢y l√† ƒëi·ªÉm ch·ª•p ·∫£nh tuy·ªát v·ªùi v·ªõi view to√†n c·∫£nh ƒë√®o H·∫£i V√¢n v√† bi·ªÉn."
          }
        ]
      },
      {
        id: 2,
        coords: [16.221596913531673, 108.0615628955108],
        title: "ƒê·∫ßm L·∫≠p An",
        description: "ƒê·∫ßm L·∫≠p An l√† ƒë·∫ßm n∆∞·ªõc l·ª£ l·ªõn nh·∫•t Hu·∫ø, n·∫±m b√™n v·ªãnh LƒÉng C√¥, n·ªïi ti·∫øng v·ªõi v·∫ª ƒë·∫πp y√™n b√¨nh, huy·ªÅn ·∫£o nh∆∞ Tuy·ªát t√¨nh c·ªëc gi·ªØa n√∫i non h√πng vƒ©.",
        image: "https://upload.wikimedia.org/wikipedia/commons/c/c9/Laguna_Lap_An%2C_Provincia_de_Thua_Thien-Hue%2C_Vietnam.jpg",
        category: "damnuoc",
        color: "#3498db",
        link: "https://example.com/dam-lap-an",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "",
        hours: "M·ªü c·∫£ ng√†y",
        price: "Mi·ªÖn ph√≠",
        filters: {
          type: "baibien",
          suitability: ["family", "couple", "solo"],
          budget: 0,
          age: ["child", "teen", "adult", "senior"],
          time: 2
        },
        tips: [
          {
            type: "tip",
            title: "Th·ªùi ƒëi·ªÉm ƒë·∫πp nh·∫•t",
            text: "ƒêi v√†o m√πa kh√¥ (th√°ng 3-8) ƒë·ªÉ th·ªùi ti·∫øt ƒë·∫πp, d·ªÖ di chuy·ªÉn; n√™n ƒë·∫øn s√°ng s·ªõm ho·∫∑c chi·ªÅu mu·ªôn ƒë·ªÉ ng·∫Øm b√¨nh minh/ho√†ng h√¥n tuy·ªát ƒë·∫πp v√† ch·ª•p ·∫£nh check-in tr√™n con ƒë∆∞·ªùng gi·ªØa ƒë·∫ßm."
          },
          {
            type: "tip",
            title: "·∫®m th·ª±c",
            text: "Th·ª≠ c√°c m√≥n h·∫£i s·∫£n t∆∞∆°i nh∆∞ h√†u n∆∞·ªõng, t√¥m h√πm t·∫°i c√°c nh√† h√†ng ven ƒë·∫ßm ƒë·ªÉ tr·∫£i nghi·ªám ·∫©m th·ª±c ƒë·ªãa ph∆∞∆°ng."
          },
          {
            type: "info",
            title: "Tr·∫£i nghi·ªám",
            text: "C√≥ th·ªÉ tham quan c√°c b√® nu√¥i h√†u v√† th∆∞·ªüng th·ª©c h·∫£i s·∫£n t∆∞∆°i s·ªëng t·∫°i ƒë·ªãa ph∆∞∆°ng."
          },
          {
            type: "warning",
            title: "L∆∞u √Ω",
            text: "Mang theo kem ch·ªëng n·∫Øng, m≈© n√≥n, n∆∞·ªõc u·ªëng v√¨ n·∫Øng n√≥ng; tr√°nh ƒëi m√πa m∆∞a (th√°ng 9-12) do ƒë∆∞·ªùng tr∆°n tr∆∞·ª£t v√† l≈© l·ª•t."
          }
        ]
      },
      {
        id: 3,
        coords: [16.317200444705676, 107.97720958202058],
        title: "B√£i bi·ªÉn T√¢n C·∫£nh D∆∞∆°ng",
        description: "Bi·ªÉn C·∫£nh D∆∞∆°ng Hu·∫ø l√† b√£i bi·ªÉn hoang s∆° d√†i 4km, c√°t tr·∫Øng m·ªãn, n∆∞·ªõc trong xanh, c√°ch trung t√¢m Hu·∫ø 50km v·ªÅ Nam, n·ªïi ti·∫øng check-in v√† c·∫Øm tr·∫°i.",
        image: "https://huesmiletravel.com.vn/images/tan_canh_duong_hue.jpg",
        category: "baibien",
        color: "#3498db",
        link: "https://example.com/tan-canh-duong",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "",
        hours: "M·ªü c·ª≠a c·∫£ ng√†y",
        price: "Mi·ªÖn ph√≠",
        filters: {
          type: "baibien",
          suitability: ["family", "couple", "solo"],
          budget: 0,
          age: ["child", "teen", "adult", "senior"],
          time: 3
        },
        tips: [
          {
            type: "tip",
            title: "Th·ªùi ƒëi·ªÉm ƒë·∫πp nh·∫•t",
            text: "ThƒÉm v√†o th√°ng 4-7 ƒë·ªÉ th·ªùi ti·∫øt n·∫Øng n√≥ng, n∆∞·ªõc bi·ªÉn hi·ªÅn h√≤a, ph√π h·ª£p t·∫Øm bi·ªÉn v√† check-in b√¨nh minh/ho√†ng h√¥n lung linh."
          },
          {
            type: "warning",
            title: "An to√†n b∆°i l·ªôi",
            text: "Ch√∫ √Ω c√°c d√≤ng ch·∫£y xa b·ªù v√† ch·ªâ b∆°i ·ªü khu v·ª±c an to√†n."
          },
          {
            type: "warning",
            title: "L∆∞u √Ω",
            text: "Chu·∫©n b·ªã kem ch·ªëng n·∫Øng, m≈© n√≥n, k√≠nh, thu·ªëc th√¥ng d·ª•ng, pin d·ª± ph√≤ng, d√©p x·ªè ng√≥n ƒë·ªÉ tho·∫£i m√°i di chuy·ªÉn v√† b·∫£o v·ªá s·ª©c kh·ªèe."
          },
          {
            type: "info",
            title: "Ti·ªán √≠ch",
            text: "Th·ª≠ c·∫Øm tr·∫°i qua ƒë√™m (l·ªÅu t·ª´ 100.000-600.000 VNƒê), teambuilding, ti·ªác BBQ, v√† th∆∞·ªüng th·ª©c h·∫£i s·∫£n t∆∞∆°i nh∆∞ t√¥m h√πm, cua g·∫°ch t·∫°i l√†ng ch√†i."
          }
        ]
      },
      {
        id: 4,
        coords: [16.312964593861636, 108.00092593156766],
        title: "B√£i bi·ªÉn B√¨nh An",
        description: "B√£i bi·ªÉn hoang s∆° v·ªõi c√°t tr·∫Øng v√† n∆∞·ªõc trong xanh, l√Ω t∆∞·ªüng cho nh·ªØng ai y√™u th√≠ch s·ª± y√™n tƒ©nh v√† thi√™n nhi√™n.",
        image: "https://scontent.fdad1-4.fna.fbcdn.net/v/t39.30808-6/490194292_2055671981509775_1096164760845721473_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeFVVLv6bJ1dXbmRfd7F-Z9eoN5f-8lrAeCg3l_7yWsB4Kxsb8nYlC-4WNTsaejFa0cYAJoA6cpGvDrlnXDLXq3b&_nc_ohc=JRPCvqp1SVoQ7kNvwHsuUiQ&_nc_oc=Adm9qWNtymx49zQxdIDlkv9KCJzV_oR--Qsy3dklaRabzb4BSVS85j4J2-vO6NTVqrxShD7nvejuefGc5FaByWz5&_nc_zt=23&_nc_ht=scontent.fdad1-4.fna&_nc_gid=GrGqcm4OfT1nJcOALMq4Jw&oh=00_Afio9UsZaU_hYaTNDG29QpjsVtA-syfVo714oe8qKt7Kwg&oe=692A5905",
        category: "baibien",
        color: "#3498db",
        link: "https://example.com/binh-an",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "",
        hours: "M·ªü c·ª≠a c·∫£ ng√†y",
        price: "Mi·ªÖn ph√≠",
        filters: {
          type: "baibien",
          suitability: ["family", "couple", "solo"],
          budget: 0,
          age: ["child", "teen", "adult", "senior"],
          time: 3
        },
        tips: [
          {
            type: "tip",
            title: "B√£i bi·ªÉn hoang s∆°",
            text: "B√£i bi·ªÉn n∆°i ƒë√¢y √≠t ng∆∞·ªùi lui t·ªõi, c·ª±c k·ª≥ l√Ω t∆∞·ªüng cho nh·ªØng ai mong t√¨m m·ªôt g√≥c b√¨nh y√™n. M·∫∑t bi·ªÉn ph·∫≥ng l·∫∑ng, s√≥ng √™m d·ªãu t·∫°o n√™n c·∫£m gi√°c nh·∫π nh√†ng, tho·∫£i m√°i."
          },
          {
            type: "warning",
            title: "An to√†n b∆°i l·ªôi",
            text: "Ch√∫ √Ω c√°c d√≤ng ch·∫£y xa b·ªù v√† ch·ªâ b∆°i ·ªü khu v·ª±c an to√†n."
          },
          {
            type: "info",
            title: "D·ªãch v·ª•",
            text: "C√≥ c√°c qu√°n ƒÉn ven bi·ªÉn, c√≥ th·ªÉ chu·∫©n b·ªã ƒë·ªì ƒÉn, n∆∞·ªõc u·ªëng ƒë·ªÉ c·∫Øm tr·∫°i."
          }
        ]
      },
      {
        id: 5,
        coords: [16.264331268498935, 108.06598731039664],
        title: "B√£i bi·ªÉn LƒÉng C√¥",
        description: "B√£i bi·ªÉn LƒÉng C√¥ l√† b√£i bi·ªÉn ƒë·∫πp ·ªü Hu·∫ø, d√†i kho·∫£ng 8km, c√°t tr·∫Øng m·ªãn, n∆∞·ªõc xanh ng·ªçc, n·∫±m ch√¢n ƒë√®o H·∫£i V√¢n, thu·ªôc v·ªãnh ƒë·∫πp nh·∫•t th·∫ø gi·ªõi, kh√≠ h·∫≠u √¥n h√≤a.",
        image: "https://live.staticflickr.com/6076/6085524345_d8efb0b2d5_b.jpg",
        category: "baibien",
        color: "#3498db",
        link: "https://example.com/lang-co",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "",
        hours: "M·ªü c·ª≠a c·∫£ ng√†y",
        price: "Mi·ªÖn ph√≠",
        filters: {
          type: "baibien",
          suitability: ["family", "couple", "solo"],
          budget: 0,
          age: ["child", "teen", "adult", "senior"],
          time: 4
        },
        tips: [
          {
            type: "tip",
            title: "Th·ªùi ƒëi·ªÉm ƒë·∫πp nh·∫•t",
            text: "ƒêi v√†o m√πa h√® (th√°ng 5-8) ƒë·ªÉ th·ªùi ti·∫øt ƒë·∫πp, n·∫Øng ·∫•m, ph√π h·ª£p t·∫Øm bi·ªÉn, ch√®o thuy·ªÅn kayak v√† th∆∞·ªüng th·ª©c h·∫£i s·∫£n t∆∞∆°i nh∆∞ t√¥m h√πm, h√†u t·∫°i c√°c nh√† h√†ng ven bi·ªÉn."
          },
          {
            type: "info",
            title: "D·ªãch v·ª• ƒëa d·∫°ng",
            text: "C√≥ nhi·ªÅu nh√† h√†ng, kh√°ch s·∫°n v√† d·ªãch v·ª• du l·ªãch xung quanh khu v·ª±c."
          },
          {
            type: "warning",
            title: "M√πa cao ƒëi·ªÉm",
            text: "Tr√°nh ƒë·∫øn v√†o cu·ªëi tu·∫ßn v√† d·ªãp l·ªÖ v√¨ r·∫•t ƒë√¥ng kh√°ch du l·ªãch."
          }
        ]
      },
      {
        id: 10,
        coords: [16.32695564023601, 107.95730352364052],
        title: "Laguna LƒÉng C√¥",
        description: "Laguna LƒÉng C√¥ l√† khu ngh·ªâ d∆∞·ª°ng ph·ª©c h·ª£p qu·ªëc t·∫ø t·∫°i V·ªãnh LƒÉng C√¥, Hu·∫ø, r·ªông 280ha, v·ªõi b√£i bi·ªÉn nguy√™n s∆°, s√¢n golf 18 l·ªó, spa cao c·∫•p v√† ho·∫°t ƒë·ªông gi·∫£i tr√≠.",
        image: "https://www.lagunalangco.com/wp-content/uploads/2024/09/Laguna-Parkside-Residences-Lang-Co-Overview-3.webp",
        category: "nghiduong",
        color: "#f39c12",
        link: "https://www.lagunalangco.com/vi/",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "0234 3695 800",
        hours: "M·ªü c·ª≠a c·∫£ ng√†y",
        price: "T·ª´ 5.724.000 VNƒê/ƒë√™m",
        filters: {
          type: "nghiduong",
          suitability: ["family", "couple"],
          budget: 4,
          age: ["adult"],
          time: 4
        },
        tips: [
          {
            type: "tip",
            title: "ƒê·∫∑t tr∆∞·ªõc",
            text: "N√™n ƒë·∫∑t ph√≤ng tr∆∞·ªõc, ƒë·∫∑c bi·ªát v√†o m√πa cao ƒëi·ªÉm t·ª´ th√°ng 6 ƒë·∫øn th√°ng 8."
          },
          {
            type: "info",
            title: "Ti·ªán nghi",
            text: "Khu ngh·ªâ d∆∞·ª°ng c√≥ ƒë·∫ßy ƒë·ªß ti·ªán nghi: h·ªì b∆°i, spa, s√¢n golf v√† nh√† h√†ng."
          },
          {
            type: "warning",
            title: "Chi ph√≠",
            text: "C√°c d·ªãch v·ª• trong khu ngh·ªâ d∆∞·ª°ng c√≥ gi√° cao, n√™n chu·∫©n b·ªã ng√¢n s√°ch ph√π h·ª£p."
          }
        ]
      },
      {
        id: 16,
        coords: [16.295, 108.085],
        title: "Ch√πa Linh ·ª®ng LƒÉng C√¥",
        description: "Ng√¥i ch√πa c·ªï k√≠nh n·∫±m tr√™n ƒë·ªìi cao v·ªõi ki·∫øn tr√∫c ƒë·ªôc ƒë√°o v√† view to√†n c·∫£nh v·ªãnh LƒÉng C√¥ tuy·ªát ƒë·∫πp.",
        image: "https://images.unsplash.com/photo-1548013146-72479768bada?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",
        category: "chua",
        color: "#9b59b6",
        link: "https://example.com/chua-linh-ung",
        address: "X√£ Ch√¢n M√¢y LƒÉng C√¥, Th√†nh ph·ªë Hu·∫ø",
        phone: "0234 123 467",
        hours: "06:00 - 18:00",
        price: "Mi·ªÖn ph√≠",
        filters: {
          type: "chua",
          suitability: ["family", "couple", "solo"],
          budget: 0,
          age: ["child", "teen", "adult", "senior"],
          time: 1
        },
        tips: [
          {
            type: "tip",
            title: "Trang ph·ª•c",
            text: "M·∫∑c trang ph·ª•c k√≠n ƒë√°o, l·ªãch s·ª± khi v√†o ch√πa."
          },
          {
            type: "info",
            title: "View ƒë·∫πp",
            text: "T·ª´ ch√πa c√≥ th·ªÉ ng·∫Øm to√†n c·∫£nh v·ªãnh LƒÉng C√¥ r·∫•t ƒë·∫πp."
          },
          {
            type: "warning",
            title: "Leo b·∫≠c thang",
            text: "Chu·∫©n b·ªã s·ª©c kh·ªèe ƒë·ªÉ leo c√°c b·∫≠c thang l√™n ch√πa."
          }
        ]
      }
      // C√°c ƒë·ªãa ƒëi·ªÉm kh√°c c√≥ th·ªÉ th√™m tips t∆∞∆°ng t·ª±
    ];

    // ========== KH·ªûI T·∫†O ·ª®NG D·ª§NG ==========
    // T·∫Øt zoom control m·∫∑c ƒë·ªãnh v√† th√™m l·∫°i ·ªü v·ªã tr√≠ mong mu·ªën
const map = L.map("map", {
  zoomControl: false
}).setView(APP_CONFIG.mapCenter, APP_CONFIG.defaultZoom);

// Th√™m zoom control ·ªü v·ªã tr√≠ m·ªõi
L.control.zoom({
  position: 'topright' // ho·∫∑c 'topleft', 'topright', 'bottomleft'
}).addTo(map);
    

    // Th√™m l·ªõp b·∫£n ƒë·ªì
    const osmLayer = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
    }).addTo(map);

    // Th√™m l·ªõp b·∫£n ƒë·ªì v·ªá tinh
    const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
      maxZoom: 18
    });

    // Bi·∫øn to√†n c·ª•c
    let boundaryLayer;
    let boundaryVisible = true;
    let isSatellite = false;
    let markerObjects = [];
    let currentMarkerIndex = -1;
    let isDarkMode = false;
    let legendVisible = true;
    
    // Bi·∫øn l∆∞u tr·∫°ng th√°i b·ªô l·ªçc
    let activeFilters = {
      type: null,
      suitability: [],
      budget: 4, // M·∫∑c ƒë·ªãnh: t·∫•t c·∫£ c√°c m·ª©c gi√°
      age: "all", // M·∫∑c ƒë·ªãnh: t·∫•t c·∫£ ƒë·ªô tu·ªïi
      time: 4 // M·∫∑c ƒë·ªãnh: t·∫•t c·∫£ th·ªùi gian
    };

    // ========== H√ÄM TI·ªÜN √çCH ==========
    
    // H√†m t·∫°o icon marker
    function createSimpleIcon(color) {
      return L.divIcon({
        className: 'simple-marker',
        html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5);"></div>`,
        iconSize: [24, 24],
        iconAnchor: [12, 24]
      });
    }

    // H√†m ·∫©n loading indicator
    function hideLoading() {
      const loading = document.getElementById('loading');
      loading.style.display = 'none';
    }

    // H√†m x·ª≠ l√Ω l·ªói
    function handleError(error, context) {
      console.error(`L·ªói trong ${context}:`, error);
    }

    // ========== QU·∫¢N L√ù RANH GI·ªöI ==========
    
    // H√†m t·∫°o ranh gi·ªõi ∆∞·ªõc l∆∞·ª£ng
    function createEstimatedBoundary() {
      const coords = [
        [16.26, 108.00],
        [16.25, 108.10],
        [16.20, 108.12],
        [16.18, 108.06],
        [16.21, 108.00],
      ];
      
      boundaryLayer = L.polygon(coords, {
        color: APP_CONFIG.boundaryColor,
        weight: APP_CONFIG.boundaryWeight,
        fillColor: APP_CONFIG.boundaryColor,
        fillOpacity: APP_CONFIG.boundaryOpacity,
      }).addTo(map);

      boundaryLayer.bindPopup(`
        <div class="popup-title">Ch√¢n M√¢y - LƒÉng C√¥</div>
        <div class="popup-description">V√πng du l·ªãch ven bi·ªÉn</div>
      `);
      
      hideLoading();
    }

    // H√†m t·∫°o ranh gi·ªõi t·ª´ d·ªØ li·ªáu OSM
    function createBoundaryFromOSMData(data) {
      try {
        const relation = data.elements.find((el) => el.type === "relation");
        if (!relation) {
          throw new Error("Kh√¥ng t√¨m th·∫•y relation trong d·ªØ li·ªáu OSM");
        }

        const nodes = new Map();
        data.elements
          .filter((el) => el.type === "node")
          .forEach((node) => nodes.set(node.id, [node.lat, node.lon]));

        const memberWays = relation.members
          .filter((m) => m.type === "way")
          .map((m) =>
            data.elements.find((el) => el.type === "way" && el.id === m.ref)
          )
          .filter(Boolean);

        const wayChains = memberWays.map((way) =>
          way.nodes.map((id) => nodes.get(id)).filter(Boolean)
        );

        const polygons = [];
        while (wayChains.length > 0) {
          let chain = wayChains.shift();
          let extended = true;

          while (extended) {
            extended = false;
            for (let i = 0; i < wayChains.length; i++) {
              const next = wayChains[i];
              const start1 = chain[0], end1 = chain[chain.length - 1];
              const start2 = next[0], end2 = next[next.length - 1];

              const same = (a, b) =>
                Math.abs(a[0] - b[0]) < 0.0001 &&
                Math.abs(a[1] - b[1]) < 0.0001;

              if (same(end1, start2)) {
                chain = [...chain, ...next.slice(1)];
                wayChains.splice(i, 1);
                extended = true;
                break;
              } else if (same(end1, end2)) {
                chain = [...chain, ...next.slice(0, -1).reverse()];
                wayChains.splice(i, 1);
                extended = true;
                break;
              } else if (same(start1, end2)) {
                chain = [...next.slice(0, -1), ...chain];
                wayChains.splice(i, 1);
                extended = true;
                break;
              } else if (same(start1, start2)) {
                chain = [...next.slice(1).reverse(), ...chain];
                wayChains.splice(i, 1);
                extended = true;
                break;
              }
            }
          }

          const first = chain[0];
          const last = chain[chain.length - 1];
          if (
            !(
              Math.abs(first[0] - last[0]) < 0.0001 &&
              Math.abs(first[1] - last[1]) < 0.0001
            )
          ) {
            chain.push(first);
          }

          polygons.push(chain);
        }

        const areas = polygons.map((poly) =>
          turf.area(turf.polygon([poly.map((p) => [p[1], p[0]])]))
        );
        const maxIndex = areas.indexOf(Math.max(...areas));
        const mainPolygon = polygons[maxIndex];

        if (!mainPolygon || mainPolygon.length < 3) {
          throw new Error("Kh√¥ng th·ªÉ t√°i t·∫°o ranh gi·ªõi ch√≠nh x√°c");
        }

        boundaryLayer = L.polygon(mainPolygon, {
          color: APP_CONFIG.boundaryColor,
          weight: APP_CONFIG.boundaryWeight,
          fillColor: APP_CONFIG.boundaryColor,
          fillOpacity: APP_CONFIG.boundaryOpacity,
        }).addTo(map);

        map.fitBounds(boundaryLayer.getBounds());
        hideLoading();
      } catch (error) {
        handleError(error, "createBoundaryFromOSMData");
        createEstimatedBoundary();
      }
    }

    // ========== QU·∫¢N L√ù MARKER V√Ä B·ªò L·ªåC ==========
    
    // H√†m th√™m marker v√†o b·∫£n ƒë·ªì
    function addMarkersToMap() {
      MARKERS_DATA.forEach(function(marker, index) {
        const simpleIcon = createSimpleIcon(marker.color);
        
        const markerObj = L.marker(marker.coords, { icon: simpleIcon })
          .addTo(map)
          .on('click', function() {
            showLocationDetails(index);
            map.setView(marker.coords, 14);
            highlightLocationItem(index);
          });
          
        markerObjects.push(markerObj);
      });
    }

    // H√†m l·ªçc v√† hi·ªÉn th·ªã marker
    function filterAndDisplayMarkers() {
      const filteredMarkers = MARKERS_DATA.filter(marker => {
        // L·ªçc theo lo·∫°i h√¨nh
        if (activeFilters.type && marker.filters.type !== activeFilters.type) {
          return false;
        }
        
        // L·ªçc theo ph√π h·ª£p
        if (activeFilters.suitability.length > 0) {
          const hasMatchingSuitability = activeFilters.suitability.some(suit => 
            marker.filters.suitability.includes(suit)
          );
          if (!hasMatchingSuitability) return false;
        }
        
        // L·ªçc theo ng√¢n s√°ch
        if (marker.filters.budget > activeFilters.budget) {
          return false;
        }
        
        // L·ªçc theo ƒë·ªô tu·ªïi
        if (activeFilters.age !== "all" && !marker.filters.age.includes(activeFilters.age)) {
          return false;
        }
        
        // L·ªçc theo th·ªùi gian
        if (marker.filters.time > activeFilters.time) {
          return false;
        }
        
        return true;
      });
      
      // ·∫®n t·∫•t c·∫£ marker
      markerObjects.forEach(marker => {
        map.removeLayer(marker);
      });
      
      // Hi·ªÉn th·ªã marker ƒë√£ l·ªçc
      filteredMarkers.forEach(markerData => {
        const index = MARKERS_DATA.findIndex(m => m.id === markerData.id);
        if (index !== -1) {
          map.addLayer(markerObjects[index]);
        }
      });
      
      // C·∫≠p nh·∫≠t danh s√°ch ƒë·ªãa ƒëi·ªÉm
      updateLocationList(filteredMarkers);
    }

    // H√†m c·∫≠p nh·∫≠t danh s√°ch ƒë·ªãa ƒëi·ªÉm
    function updateLocationList(filteredMarkers) {
      const locationList = document.getElementById('location-list');
      locationList.innerHTML = '';
      
      filteredMarkers.forEach(function(markerData) {
        const index = MARKERS_DATA.findIndex(m => m.id === markerData.id);
        if (index === -1) return;
        
        const listItem = document.createElement('li');
        listItem.className = 'location-item fade-in';
        listItem.setAttribute('data-id', markerData.id);
        
        // T·∫°o tags hi·ªÉn th·ªã
        const tagsHTML = createTagsHTML(markerData.filters);
        
        listItem.innerHTML = `
          <div class="location-icon" style="background-color: ${markerData.color}">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <div class="location-content">
            <div class="location-title">${markerData.title}</div>
            <div class="location-desc">${markerData.description.substring(0, 80)}...</div>
            <div class="location-tags">
              ${tagsHTML}
            </div>
          </div>
        `;
        
        listItem.addEventListener('click', function() {
          // Di chuy·ªÉn b·∫£n ƒë·ªì ƒë·∫øn v·ªã tr√≠ marker
          map.setView(markerData.coords, 14);
          // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt
          showLocationDetails(index);
          // ƒê√°nh d·∫•u item ƒë∆∞·ª£c ch·ªçn
          highlightLocationItem(index);
          
          // T·ª± ƒë·ªông ƒë√≥ng sidebar tr√™n di ƒë·ªông
          if (window.innerWidth <= 768) {
            sidebar.classList.add('collapsed');
            sidebarToggle.innerHTML = '<i class="fas fa-bars"></i>';
          }
        });
        
        locationList.appendChild(listItem);
      });
      
      // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu kh√¥ng c√≥ k·∫øt qu·∫£
      if (filteredMarkers.length === 0) {
        const noResults = document.createElement('li');
        noResults.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #718096;">
            <i class="fas fa-search" style="font-size: 24px; margin-bottom: 10px;"></i>
            <div>Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm ph√π h·ª£p</div>
          </div>
        `;
        locationList.appendChild(noResults);
      }
    }

    // H√†m t·∫°o HTML cho tags
    function createTagsHTML(filters) {
      let tagsHTML = '';
      
      // Tag lo·∫°i h√¨nh
      const typeLabels = {
        'baibien': 'üèñÔ∏è B√£i bi·ªÉn',
        'nghiduong': 'üè® Resort',
        'nhahang': 'üçΩÔ∏è ·∫®m th·ª±c',
        'ditich': 'üèõÔ∏è Di t√≠ch',
        'giaitri': 'üéØ Gi·∫£i tr√≠',
        'muasam': 'üõçÔ∏è Mua s·∫Øm',
        'chua': 'üõï Ch√πa chi·ªÅn'
      };
      
      if (typeLabels[filters.type]) {
        tagsHTML += `<div class="location-tag">${typeLabels[filters.type]}</div>`;
      }
      
      // Tag ng√¢n s√°ch
      const budgetLabels = ['üí∞ Mi·ªÖn ph√≠', 'üí∞ Ti·∫øt ki·ªám', 'üí∞ Trung b√¨nh', 'üí∞ Cao c·∫•p', 'üí∞ Luxury'];
      tagsHTML += `<div class="location-tag">${budgetLabels[filters.budget]}</div>`;
      
      // Tag th·ªùi gian
      const timeLabels = ['‚è±Ô∏è D∆∞·ªõi 1h', '‚è±Ô∏è 1-2h', '‚è±Ô∏è 2-4h', '‚è±Ô∏è N·ª≠a ng√†y', '‚è±Ô∏è C·∫£ ng√†y'];
      tagsHTML += `<div class="location-tag">${timeLabels[filters.time]}</div>`;
      
      return tagsHTML;
    }

    // H√†m t·∫°o danh s√°ch ƒë·ªãa ƒëi·ªÉm trong sidebar
    function createLocationList() {
      updateLocationList(MARKERS_DATA);
    }

    // H√†m ƒë√°nh d·∫•u item trong danh s√°ch
    function highlightLocationItem(index) {
      const items = document.querySelectorAll('.location-item');
      items.forEach(function(item, i) {
        if (i === index) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      currentMarkerIndex = index;
    }

    // H√†m hi·ªÉn th·ªã chi ti·∫øt ƒë·ªãa ƒëi·ªÉm
    function showLocationDetails(index) {
      const marker = MARKERS_DATA[index];
      const infoPanel = document.getElementById('info-panel');
      
      // C·∫≠p nh·∫≠t th√¥ng tin
      document.getElementById('info-image').src = marker.image;
      document.getElementById('info-title').textContent = marker.title;
      document.getElementById('info-description').textContent = marker.description;
      document.getElementById('info-address').textContent = marker.address;
      document.getElementById('info-phone').textContent = marker.phone || "Kh√¥ng c√≥ th√¥ng tin";
      document.getElementById('info-hours').textContent = marker.hours;
      document.getElementById('info-price').textContent = marker.price;
      
      // C·∫≠p nh·∫≠t tags trong info panel
      const infoTags = document.getElementById('info-tags');
      infoTags.innerHTML = createTagsHTML(marker.filters);
      
      // C·∫≠p nh·∫≠t tips v√† l∆∞u √Ω
      updateTipsSection(marker);
      
      // C·∫≠p nh·∫≠t s·ª± ki·ªán cho c√°c n√∫t
      document.getElementById('info-website').onclick = function() {
        if (marker.link && marker.link !== "https://example.com") {
          window.open(marker.link, '_blank');
        } else {
          alert("Kh√¥ng c√≥ th√¥ng tin website cho ƒë·ªãa ƒëi·ªÉm n√†y");
        }
      };
      
      document.getElementById('info-direction').onclick = function() {
        const url = `https://www.google.com/maps/dir/?api=1&destination=${marker.coords[0]},${marker.coords[1]}`;
        window.open(url, '_blank');
      };
      
      // Hi·ªÉn th·ªã panel
      infoPanel.classList.add('active');
    }

    // H√†m c·∫≠p nh·∫≠t ph·∫ßn Tips & L∆∞u √Ω
    function updateTipsSection(marker) {
      const tipsList = document.getElementById('tips-list');
      tipsList.innerHTML = '';
      
      if (marker.tips && marker.tips.length > 0) {
        marker.tips.forEach(tip => {
          const tipItem = document.createElement('li');
          tipItem.className = 'tip-item';
          
          let iconClass = '';
          let iconSymbol = '';
          
          switch(tip.type) {
            case 'tip':
              iconClass = 'tip';
              iconSymbol = 'üí°';
              break;
            case 'warning':
              iconClass = 'warning';
              iconSymbol = '‚ö†Ô∏è';
              break;
            case 'info':
              iconClass = 'info';
              iconSymbol = '‚ÑπÔ∏è';
              break;
            default:
              iconClass = 'info';
              iconSymbol = '‚ÑπÔ∏è';
          }
          
          tipItem.innerHTML = `
            <div class="tip-icon ${iconClass}">${iconSymbol}</div>
            <div class="tip-content">
              <div class="tip-title">${tip.title}</div>
              <div class="tip-text">${tip.text}</div>
            </div>
          `;
          
          tipsList.appendChild(tipItem);
        });
        
        // Hi·ªÉn th·ªã section tips
        document.getElementById('tips-content').classList.remove('collapsed');
        document.getElementById('tips-toggle').classList.add('rotated');
      } else {
        // ·∫®n section tips n·∫øu kh√¥ng c√≥ tips
        document.getElementById('tips-content').classList.add('collapsed');
        document.getElementById('tips-toggle').classList.remove('rotated');
      }
    }

    // ========== CH·ª®C NƒÇNG T√åM KI·∫æM TH√îNG MINH ==========
    
    // H√†m t√¨m ki·∫øm th√¥ng minh v·ªõi g·ª£i √Ω
    function setupSmartSearch() {
      const searchInput = document.getElementById('search-input');
      const searchSuggestions = document.getElementById('search-suggestions');
      let currentSuggestionIndex = -1;
      let suggestions = [];

      // H√†m t√¨m ki·∫øm ƒë·ªãa ƒëi·ªÉm
      function searchLocations(query) {
        if (!query.trim()) {
          return [];
        }

        const searchTerm = query.toLowerCase();
        const results = [];

        MARKERS_DATA.forEach(marker => {
          const title = marker.title.toLowerCase();
          const address = marker.address.toLowerCase();
          const description = marker.description.toLowerCase();
          const category = getCategoryLabel(marker.filters.type);

          // T√≠nh ƒëi·ªÉm ph√π h·ª£p
          let score = 0;

          // T√¨m trong ti√™u ƒë·ªÅ (quan tr·ªçng nh·∫•t)
          if (title.includes(searchTerm)) {
            score += 100;
            // N·∫øu kh·ªõp ch√≠nh x√°c t·ª´ ƒë·∫ßu
            if (title.startsWith(searchTerm)) {
              score += 50;
            }
          }

          // T√¨m trong ƒë·ªãa ch·ªâ
          if (address.includes(searchTerm)) {
            score += 30;
          }

          // T√¨m trong m√¥ t·∫£
          if (description.includes(searchTerm)) {
            score += 20;
          }

          // T√¨m trong lo·∫°i h√¨nh
          if (category.toLowerCase().includes(searchTerm)) {
            score += 15;
          }

          if (score > 0) {
            results.push({
              marker: marker,
              score: score,
              matchedIn: {
                title: title.includes(searchTerm),
                address: address.includes(searchTerm),
                description: description.includes(searchTerm),
                category: category.toLowerCase().includes(searchTerm)
              }
            });
          }
        });

        // S·∫Øp x·∫øp theo ƒëi·ªÉm
        return results.sort((a, b) => b.score - a.score).slice(0, 8);
      }

      // H√†m l·∫•y nh√£n lo·∫°i h√¨nh
      function getCategoryLabel(type) {
        const labels = {
          'baibien': 'B√£i bi·ªÉn',
          'nghiduong': 'Resort & Kh√°ch s·∫°n',
          'nhahang': 'Nh√† h√†ng & ·∫®m th·ª±c',
          'ditich': 'Di t√≠ch l·ªãch s·ª≠',
          'giaitri': 'Gi·∫£i tr√≠',
          'muasam': 'Mua s·∫Øm',
          'chua': 'Ch√πa chi·ªÅn',
          'damnuoc': 'ƒê·∫ßm n∆∞·ªõc',
          'suoi': 'Su·ªëi & Th√°c n∆∞·ªõc'
        };
        return labels[type] || 'ƒê·ªãa ƒëi·ªÉm';
      }

      // H√†m l·∫•y icon cho lo·∫°i h√¨nh
      function getCategoryIcon(type) {
        const icons = {
          'baibien': 'üèñÔ∏è',
          'nghiduong': 'üè®',
          'nhahang': 'üçΩÔ∏è',
          'ditich': 'üèõÔ∏è',
          'giaitri': 'üéØ',
          'muasam': 'üõçÔ∏è',
          'chua': 'üõï',
          'damnuoc': 'üåä',
          'suoi': 'üíß'
        };
        return icons[type] || 'üìç';
      }

      // H√†m hi·ªÉn th·ªã g·ª£i √Ω
      function showSuggestions(results) {
        suggestions = results;
        currentSuggestionIndex = -1;

        if (results.length === 0) {
          searchSuggestions.innerHTML = `
            <div class="no-results">
              <i class="fas fa-search" style="margin-bottom: 8px; font-size: 20px;"></i>
              <div>Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm ph√π h·ª£p</div>
              <small>Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</small>
            </div>
          `;
        } else {
          searchSuggestions.innerHTML = results.map((result, index) => {
            const marker = result.marker;
            const icon = getCategoryIcon(marker.filters.type);
            const category = getCategoryLabel(marker.filters.type);
            
            // Highlight t·ª´ kh√≥a t√¨m ki·∫øm
            const searchTerm = searchInput.value.toLowerCase();
            const highlightedTitle = highlightText(marker.title, searchTerm);
            const highlightedAddress = highlightText(marker.address, searchTerm);

            return `
              <div class="search-suggestion" data-index="${index}">
                <div class="suggestion-icon" style="background-color: ${marker.color}">
                  ${icon}
                </div>
                <div class="suggestion-content">
                  <div class="suggestion-title">${highlightedTitle}</div>
                  <div class="suggestion-address">${highlightedAddress}</div>
                </div>
                <div class="suggestion-category">${category}</div>
              </div>
            `;
          }).join('');
        }

        searchSuggestions.classList.add('show');
      }

      // H√†m highlight t·ª´ kh√≥a trong vƒÉn b·∫£n
      function highlightText(text, searchTerm) {
        if (!searchTerm.trim()) return text;
        
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
      }

      // H√†m ch·ªçn g·ª£i √Ω
      function selectSuggestion(index) {
        if (index >= 0 && index < suggestions.length) {
          const marker = suggestions[index].marker;
          const markerIndex = MARKERS_DATA.findIndex(m => m.id === marker.id);
          
          if (markerIndex !== -1) {
            // Di chuy·ªÉn b·∫£n ƒë·ªì ƒë·∫øn v·ªã tr√≠
            map.setView(marker.coords, 14);
            
            // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt
            showLocationDetails(markerIndex);
            
            // ƒê√°nh d·∫•u item trong danh s√°ch
            highlightLocationItem(markerIndex);
            
            // ƒê√≥ng g·ª£i √Ω t√¨m ki·∫øm
            hideSuggestions();
            
            // X√≥a n·ªôi dung t√¨m ki·∫øm
            searchInput.value = '';
            
            // T·ª± ƒë·ªông ƒë√≥ng sidebar tr√™n di ƒë·ªông
            if (window.innerWidth <= 768) {
              sidebar.classList.add('collapsed');
              sidebarToggle.innerHTML = '<i class="fas fa-bars"></i>';
            }
          }
        }
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestions() {
        searchSuggestions.classList.remove('show');
        currentSuggestionIndex = -1;
      }

      // S·ª± ki·ªán nh·∫≠p li·ªáu
      searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        if (query.length >= 2) {
          const results = searchLocations(query);
          showSuggestions(results);
        } else {
          hideSuggestions();
        }
      });

      // S·ª± ki·ªán focus
      searchInput.addEventListener('focus', function() {
        const query = this.value.trim();
        if (query.length >= 2) {
          const results = searchLocations(query);
          showSuggestions(results);
        }
      });

      // S·ª± ki·ªán click ra ngo√†i ƒë·ªÉ ƒë√≥ng g·ª£i √Ω
      document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
          hideSuggestions();
        }
      });

      // S·ª± ki·ªán click v√†o g·ª£i √Ω
      searchSuggestions.addEventListener('click', function(e) {
        const suggestion = e.target.closest('.search-suggestion');
        if (suggestion) {
          const index = parseInt(suggestion.getAttribute('data-index'));
          selectSuggestion(index);
        }
      });

      // S·ª± ki·ªán b√†n ph√≠m
      searchInput.addEventListener('keydown', function(e) {
        if (!searchSuggestions.classList.contains('show')) return;

        switch(e.key) {
          case 'ArrowDown':
            e.preventDefault();
            currentSuggestionIndex = Math.min(currentSuggestionIndex + 1, suggestions.length - 1);
            updateSuggestionSelection();
            break;

          case 'ArrowUp':
            e.preventDefault();
            currentSuggestionIndex = Math.max(currentSuggestionIndex - 1, -1);
            updateSuggestionSelection();
            break;

          case 'Enter':
            e.preventDefault();
            if (currentSuggestionIndex >= 0) {
              selectSuggestion(currentSuggestionIndex);
            } else if (suggestions.length > 0) {
              selectSuggestion(0);
            }
            break;

          case 'Escape':
            hideSuggestions();
            break;
        }
      });

      // H√†m c·∫≠p nh·∫≠t l·ª±a ch·ªçn g·ª£i √Ω
      function updateSuggestionSelection() {
        const allSuggestions = searchSuggestions.querySelectorAll('.search-suggestion');
        
        allSuggestions.forEach((suggestion, index) => {
          if (index === currentSuggestionIndex) {
            suggestion.classList.add('active');
            // Cu·ªôn ƒë·∫øn ph·∫ßn t·ª≠ ƒë∆∞·ª£c ch·ªçn
            suggestion.scrollIntoView({ block: 'nearest' });
          } else {
            suggestion.classList.remove('active');
          }
        });

        // N·∫øu kh√¥ng c√≥ g·ª£i √Ω n√†o ƒë∆∞·ª£c ch·ªçn, focus v√†o input
        if (currentSuggestionIndex === -1) {
          searchInput.focus();
        }
      }

      // T·ª± ƒë·ªông focus v√†o √¥ t√¨m ki·∫øm khi m·ªü sidebar
      const sidebar = document.getElementById('sidebar');
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'class') {
            if (!sidebar.classList.contains('collapsed')) {
              setTimeout(() => {
                searchInput.focus();
              }, 300);
            }
          }
        });
      });

      observer.observe(sidebar, { attributes: true });
    }

    // ========== X·ª¨ L√ù S·ª∞ KI·ªÜN B·ªò L·ªåC ==========
    
    // H√†m thi·∫øt l·∫≠p b·ªô l·ªçc
    function setupFilters() {
      // B·ªô l·ªçc lo·∫°i h√¨nh
      const typeFilterTags = document.querySelectorAll('.filter-tag[data-type]');
      typeFilterTags.forEach(tag => {
        tag.addEventListener('click', function() {
          const type = this.getAttribute('data-type');
          
          // Toggle active state
          if (this.classList.contains('active')) {
            this.classList.remove('active');
            activeFilters.type = null;
          } else {
            // Remove active from all type filters
            typeFilterTags.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            activeFilters.type = type;
          }
          
          filterAndDisplayMarkers();
        });
      });
      
      // B·ªô l·ªçc ph√π h·ª£p
      const suitabilityTags = document.querySelectorAll('.filter-tag[data-criteria]');
      suitabilityTags.forEach(tag => {
        tag.addEventListener('click', function() {
          const criteria = this.getAttribute('data-criteria');
          
          // Toggle active state
          if (this.classList.contains('active')) {
            this.classList.remove('active');
            activeFilters.suitability = activeFilters.suitability.filter(c => c !== criteria);
          } else {
            this.classList.add('active');
            activeFilters.suitability.push(criteria);
          }
          
          filterAndDisplayMarkers();
        });
      });
      
      // B·ªô l·ªçc ng√¢n s√°ch
      const budgetSlider = document.getElementById('budget-slider');
      budgetSlider.addEventListener('input', function() {
        activeFilters.budget = parseInt(this.value);
        filterAndDisplayMarkers();
      });
      
      // B·ªô l·ªçc ƒë·ªô tu·ªïi
      const ageButtons = document.querySelectorAll('.age-btn');
      ageButtons.forEach(button => {
        button.addEventListener('click', function() {
          const age = this.getAttribute('data-age');
          
          // Remove active from all age buttons
          ageButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          activeFilters.age = age;
          filterAndDisplayMarkers();
        });
      });
      
      // B·ªô l·ªçc th·ªùi gian
      const timeSlider = document.getElementById('time-slider');
      timeSlider.addEventListener('input', function() {
        activeFilters.time = parseInt(this.value);
        filterAndDisplayMarkers();
      });
      
      // N√∫t x√≥a t·∫•t c·∫£ b·ªô l·ªçc
      document.getElementById('clear-filters').addEventListener('click', function() {
        // Reset all filters
        activeFilters = {
          type: null,
          suitability: [],
          budget: 4,
          age: "all",
          time: 4
        };
        
        // Reset UI
        typeFilterTags.forEach(tag => tag.classList.remove('active'));
        suitabilityTags.forEach(tag => tag.classList.remove('active'));
        budgetSlider.value = 4;
        timeSlider.value = 4;
        ageButtons.forEach(btn => {
          if (btn.getAttribute('data-age') === 'all') {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
        
        filterAndDisplayMarkers();
      });
    }

    // H√†m thi·∫øt l·∫≠p toggle cho b·ªô l·ªçc
    function setupFilterToggles() {
      const typeFilterHeader = document.getElementById('type-filter-header');
      const typeFilterContent = document.getElementById('type-filter-content');
      const typeFilterToggle = document.getElementById('type-filter-toggle');
      
      const criteriaFilterHeader = document.getElementById('criteria-filter-header');
      const criteriaFilterContent = document.getElementById('criteria-filter-content');
      const criteriaFilterToggle = document.getElementById('criteria-filter-toggle');
      
      // Toggle b·ªô l·ªçc lo·∫°i h√¨nh
      typeFilterHeader.addEventListener('click', function() {
        typeFilterContent.classList.toggle('collapsed');
        typeFilterToggle.classList.toggle('rotated');
      });
      
      // Toggle b·ªô l·ªçc ti√™u ch√≠
      criteriaFilterHeader.addEventListener('click', function() {
        criteriaFilterContent.classList.toggle('collapsed');
        criteriaFilterToggle.classList.toggle('rotated');
      });
    }

    // H√†m thi·∫øt l·∫≠p toggle cho tips section
    function setupTipsToggle() {
      const tipsHeader = document.getElementById('tips-header');
      const tipsContent = document.getElementById('tips-content');
      const tipsToggle = document.getElementById('tips-toggle');
      
      tipsHeader.addEventListener('click', function() {
        tipsContent.classList.toggle('collapsed');
        tipsToggle.classList.toggle('rotated');
      });
    }

    // ========== X·ª¨ L√ù S·ª∞ KI·ªÜN KH√ÅC ==========
    
    // X·ª≠ l√Ω s·ª± ki·ªán sidebar
    function setupSidebar() {
      const sidebar = document.getElementById('sidebar');
      const sidebarClose = document.getElementById('sidebar-close');
      const sidebarOpen = document.getElementById('sidebar-open');
      
      // N√∫t ƒë√≥ng b√™n trong sidebar
      sidebarClose.addEventListener('click', function() {
        sidebar.classList.add('collapsed');
      });
      
      // N√∫t m·ªü sidebar (lu√¥n hi·ªÉn th·ªã)
      sidebarOpen.addEventListener('click', function() {
        sidebar.classList.remove('collapsed');
      });
    }

    // X·ª≠ l√Ω s·ª± ki·ªán ƒë√≥ng info panel
    function setupInfoPanel() {
      document.getElementById('info-close').addEventListener('click', function() {
        document.getElementById('info-panel').classList.remove('active');
      });
    }

    // X·ª≠ l√Ω s·ª± ki·ªán c√°c n√∫t ƒëi·ªÅu khi·ªÉn b·∫£n ƒë·ªì
    function setupMapControls() {
      // N√∫t locate me
      document.getElementById('locate-me').addEventListener('click', function() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const latlng = L.latLng(position.coords.latitude, position.coords.longitude);
            map.setView(latlng, 14);
            L.marker(latlng)
              .addTo(map)
              .bindPopup("V·ªã tr√≠ c·ªßa b·∫°n")
              .openPopup();
          }, function(error) {
            alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ c·ªßa b·∫°n: " + error.message);
          });
        } else {
          alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã");
        }
      });

      // N√∫t toggle boundary
      document.getElementById('toggle-boundary').addEventListener('click', function() {
        if (boundaryLayer) {
          if (boundaryVisible) {
            map.removeLayer(boundaryLayer);
          } else {
            map.addLayer(boundaryLayer);
          }
          boundaryVisible = !boundaryVisible;
        }
      });

      // N√∫t toggle satellite
      document.getElementById('toggle-satellite').addEventListener('click', function() {
        if (isSatellite) {
          map.removeLayer(satelliteLayer);
          map.addLayer(osmLayer);
        } else {
          map.removeLayer(osmLayer);
          map.addLayer(satelliteLayer);
        }
        isSatellite = !isSatellite;
      });

      // N√∫t fullscreen
      document.getElementById('fullscreen').addEventListener('click', function() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
          this.innerHTML = '<i class="fas fa-compress"></i>';
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
            this.innerHTML = '<i class="fas fa-expand"></i>';
          }
        }
      });
    }

    // Thi·∫øt l·∫≠p ch·∫ø ƒë·ªô t·ªëi/s√°ng
    function setupThemeToggle() {
      const themeToggle = document.getElementById('theme-toggle');
      
      // Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ s·ªü th√≠ch ch·∫ø ƒë·ªô t·ªëi kh√¥ng
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        isDarkMode = true;
        document.body.classList.add('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      
      themeToggle.addEventListener('click', function() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode');
        
        if (isDarkMode) {
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
        
        // L∆∞u t√πy ch·ªçn v√†o localStorage
        localStorage.setItem('darkMode', isDarkMode);
      });
      
      // Ki·ªÉm tra localStorage
      const savedDarkMode = localStorage.getItem('darkMode');
      if (savedDarkMode !== null) {
        isDarkMode = savedDarkMode === 'true';
        if (isDarkMode) {
          document.body.classList.add('dark-mode');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
      }
    }

    // Thi·∫øt l·∫≠p UX cho thi·∫øt b·ªã di ƒë·ªông
    function setupMobileUX() {
      const isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        // ƒê√≥ng sidebar khi ch·ªçn ƒë·ªãa ƒëi·ªÉm
        const locationItems = document.querySelectorAll('.location-item');
        locationItems.forEach(item => {
          item.addEventListener('click', () => {
            sidebar.classList.add('collapsed');
          });
        });
        
        // ƒê√≥ng info panel khi nh·∫•n ra ngo√†i (tr√™n di ƒë·ªông)
        document.addEventListener('click', (e) => {
          const infoPanel = document.getElementById('info-panel');
          if (infoPanel.classList.contains('active') && 
              !e.target.closest('.info-panel') && 
              !e.target.closest('.location-item') &&
              !e.target.closest('.simple-marker')) {
            infoPanel.classList.remove('active');
          }
        });
      }
    }

    // Thi·∫øt l·∫≠p n√∫t ·∫©n/hi·ªán ch√∫ th√≠ch
    function setupLegendToggle() {
      const legendToggle = document.getElementById('legend-toggle');
      const legendShow = document.getElementById('legend-show');
      const legend = document.getElementById('legend');
      
      legendToggle.addEventListener('click', function() {
        legendVisible = !legendVisible;
        
        if (legendVisible) {
          legend.classList.remove('hidden');
          legendShow.classList.remove('visible');
          legendToggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
          legend.classList.add('hidden');
          legendShow.classList.add('visible');
          legendToggle.innerHTML = '<i class="fas fa-eye"></i>';
        }
        
        // L∆∞u t√πy ch·ªçn v√†o localStorage
        localStorage.setItem('legendVisible', legendVisible);
      });
      
      // N√∫t hi·ªán ch√∫ th√≠ch
      legendShow.addEventListener('click', function() {
        legendVisible = true;
        legend.classList.remove('hidden');
        legendShow.classList.remove('visible');
        legendToggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
        
        // L∆∞u t√πy ch·ªçn v√†o localStorage
        localStorage.setItem('legendVisible', legendVisible);
      });
      
      // Ki·ªÉm tra localStorage
      const savedLegendVisible = localStorage.getItem('legendVisible');
      if (savedLegendVisible !== null) {
        legendVisible = savedLegendVisible === 'true';
        if (!legendVisible) {
          legend.classList.add('hidden');
          legendShow.classList.add('visible');
          legendToggle.innerHTML = '<i class="fas fa-eye"></i>';
        }
      }
    }

    // ========== KH·ªûI T·∫†O ·ª®NG D·ª§NG ==========
    
    // H√†m kh·ªüi t·∫°o ·ª©ng d·ª•ng
    function initApp() {
      // G·ªçi d·ªØ li·ªáu OSM ƒë·ªÉ t·∫°o ranh gi·ªõi
      fetch(`https://overpass-api.de/api/interpreter?data=[out:json];relation(${APP_CONFIG.osmRelationId});(._;>;);out;`)
        .then((res) => res.json())
        .then(createBoundaryFromOSMData)
        .catch((err) => {
          handleError(err, "fetch OSM data");
          createEstimatedBoundary();
        });

      // Th√™m marker v√†o b·∫£n ƒë·ªì
      addMarkersToMap();
      
      // T·∫°o danh s√°ch ƒë·ªãa ƒëi·ªÉm
      createLocationList();
      
      // Thi·∫øt l·∫≠p c√°c s·ª± ki·ªán
      setupSmartSearch();
      setupFilters();
      setupFilterToggles();
      setupTipsToggle();
      setupSidebar();
      setupInfoPanel();
      setupMapControls();
      setupThemeToggle();
      setupLegendToggle();
      setupMobileUX();
      
      // ·∫®n loading sau khi t·∫£i xong
      setTimeout(hideLoading, 1000);
    }

    // Kh·ªüi ch·∫°y ·ª©ng d·ª•ng khi DOM ƒë√£ s·∫µn s√†ng
    document.addEventListener('DOMContentLoaded', initApp);
    
    // Thi·∫øt l·∫≠p l·∫°i UX khi thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ª≠a s·ªï
    window.addEventListener('resize', setupMobileUX);
  </script>
</body>
</html>